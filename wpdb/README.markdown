# wpdb - What is this?

This directory contains scripts that are used to generate JSON feeds that populate various pages and widgets across the IMO network. It's called WPDB because all of the scripts access the imomags WordPress Database. These scripts are designed to avoid bootstrapping an entire WordPress install just to return a little bit of data. All of the scripts in this directory use the database configuration in the **mysql.php** file. 

Many of the scripts in this directory are obsolete and no longer used. Here are a few that I know that we still need:

## Used Scripts

* **network-feed-cached.php** - This file could have it's own sepearate README. It is responsible for generating JSON feeds that appear on pages all over the IMO network. The actual SQL queries for this script are in the *csf-queries.php* file. However, those queries run so slowly that a caching system needed to be developed. *network-feed-cached.php* handles the caching for the json results that are generated by the *csf-queries.php*. The *network-feed-cached.php* script uses a unique caching mechanism that minimizes the time that users spend waiting for content to be generated. When a specific feed is requested, the script will check to see if the cache has expired for that feed. If the cache is good, it returns the feed. If the cache has expired, it also returns the cached feed! After it has sent the JSON feed to the browser, it regenerates the cached results. So, the user is never waiting for an expired feed. It's worth noting that the results of this JSON feed are also cached by Varnish.
*  **csf-queries.php** - Used by the *network-feed-cached.php*, the queries in this file are unbelievably long and complicated. They are designed to allow a web developer to specifiy a taxonomy term and recieve results for any post that is categorized by that term accross all 15 imomags sites. As such, it has to query each site separately and UNION the results together. It's terrible and it takes forever to run. Hence, the agreesive caching.

