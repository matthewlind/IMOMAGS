<!doctype html>
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title></title>
	<meta name="description" content="">
	<meta name="author" content="">

	<meta name="viewport" content="width=device-width,initial-scale=1">

	<link rel="stylesheet" href="..css/style.css">
	<link rel="stylesheet" href="..css/overstyle.css">

	<script src="../js/vendor/modernizr-2.6.2.min.js"></script>
	<script src="../js/vendor/jquery-1.10.2.min.js"></script>
	<script src="../js/vendor/underscore.js"></script>
	<script src="../js/vendor/backbone.js"></script>
	
	<script src="moment.js"></script>
	
	
	<link rel="stylesheet" href="style.css">
	
	<script src="tscschedule.json"></script>

<script>


$(document).ready(function() {

  var deferBarEvents = $.Deferred();
  deferBarEvents.done(function(){
    jQuery('.daybaritem').click(function() {
      var wday = jQuery(this).data('wday').toUpperCase();
      var dayidx = jQuery(this).data('dayidx');
      var rdate = jQuery(this).data('rdate');
      var wshows = new Array();
      
      jQuery.each(sdata, function(idx, row) {
        
        jQuery.each(row.Timeslots, function(tidx, tval){
					
          var tslot = tval.src.split(" ");

          if(tval.rdate == rdate) {
            var ttime = tslot[1].split(":");
            var ohour = ttime[0];
            var shour = ("00"+ohour).slice(-2);
            var smin  = ttime[1].substr(0,2);
            var ampm  = ttime[1].substr(2,2);
            var smhour = (ampm == "PM")? parseInt(shour)+12:shour;
            var mslot = smhour+":"+smin;
			
            wshows.push({"DayID": dayidx, "Slot": mslot, "rtime": tval.rtime, "time": ohour+":"+smin, "ampm": ampm, "Show": row});
          }
        });
      });
      
      wshows.sort(function(a,b) { if(a.rtime > b.rtime) return 1;else if(a.rtime < b.rtime) return -1; else return 0 } );
      console.log(wshows);

      var sw = "";
      var ptime = "";
      jQuery.each(wshows, function(sidx, srow) {
        var airnow = "";
        var earlier = "";
        if(srow.DayID=="0") {//alert(now);
          if(srow.rtime.substr(0,2) == now.substr(0,2)) {airnow = "Airing Now"}
          if(srow.rtime.substr(0,2) < now.substr(0,2)) earlier = "earlier";
        }
        var allnew = (srow.Show.NewEpisode=="YES")? " - All New":"";
		    	
        sw += '<article class="schedule-content tiled-grid padded-tile clr '+earlier+'">'
           + '<div class="content clr">'
           + '  <div class="left">'
           + '    <span class="time">'+srow.time+' '+srow.ampm.toLowerCase()+'</span>'
           + '    <span class="airing">'+airnow+'</span>'
           + '  </div>'
           + '    <div class="show-content right">'
           //+ '      <img src="" alt="" title="" /><!--width: 200px;height: 120px; WP thumbnail name: "schedule-thumb" -->'
           + '      <h2><a href="#">'+srow.Show.SeriesTitle+'<span class="all-new">'+allnew+'</span></a></h2>'
           + '      <div class="episode">'+srow.Show.EpisodeTitle+'</div>'
           + '      <div class="episode-description">'+srow.Show.EpisodeDescription+'</div>'
           + '    </div>'
           + '  </div>'
           + '</article>';
				
      });
      jQuery('.day').removeClass("active");
      jQuery(this).addClass("active");
      jQuery('#daycontent').html(sw);
			
    });
	        
  });
    
	var daylist = "";

	for(var i=0; i < 7; i++) {
		
		now = moment().format("HH:mm");
		
		day = moment().add("days", i)
    	fday = day.format("YYYY/MM/DD");
    	mday = day.format("ddd,MMM DD");
		mday = mday.split(",");
		
		daylist += '<li><div data-wday="'+mday[0]+'" data-dayidx="'+i+'" data-rdate="'+fday+'" '
		if(i==0) daylist += ' id ="firstday"';
		daylist += ' class="day daybaritem';
		if(i==0) daylist += ' active';
		daylist += '" >'+mday[0].toUpperCase()+'<span class="date">'+mday[1]+'</span></div></li>';
		
	}
	jQuery('#daybar').html(daylist);
	deferBarEvents.resolve();
    
    deferBarEvents.done(function() {
	    jQuery('#firstday').trigger("click");
    })
});

	
</script>
<style>
	#daybar {
	
		clear: both;
	}
	.daybaritem {
		float: left;
		width: 100px;
	}
	.daybaritem .wday {
		font-weight: bold;
		font-size: larger;
		display: block;
	}
	.daybaritem .wdate {
		display: block;
	}
	.contentNOT {
		width:80%;
	}
	.show-content {
		width:80%;
	}
	article.earlier {
		display:none;
	}

</style>
</head>
<body>
<div id="results"></div>

<section id="schedule" class="content-area full-width clr">
	<div id="content" class="site-content" role="main">
		
		<div class="container clr">
			<article class="schedule-header tiled-grid padded-tile clr">
				<h2 class="tiled-grid-heading">
					<span>Schedule</span>
				</h2><!-- .tiled-grid-heading -->
			</article><!-- .tiled-grid -->  
			
			<article class="schedule tiled-grid padded-tile clr">
                	<ul class="slides" id="daybar">

					</ul>
			</article>
			<div id="daycontent">

			</div>
		</div><!-- .container -->    
    </div>            
</section>

<script type='text/javascript'>
/* <![CDATA[ */
var wpexLocalize = {"responsiveMenuText":"Menu"};
/* ]]> */
</script>
<script src="global.js"></script>
</body>
</html>